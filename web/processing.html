<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>句子审核中 | Zitat一谚</title>
    <link rel="stylesheet" href="styles/loginform.css">
</head>
<body>
    <div class="background">
        <div class="circle"></div>
        <div class="circle"></div>
        <div class="circle"></div>
    </div>
    
    <div class="login-container">
        <img src="assets/logo.png" alt="Logo" class="logo">
        <h1 class="login-title">句子审核中</h1>
        
        <div class="form-group">
            <div id="statusDisplay" style="font-size: 40px; font-weight: bold; margin: 15px 0; padding: 10px; border-radius: 5px; text-align: center; color: #337ab7;">
                审核进行中...
            </div>
        </div>
        
        <div class="form-group">
            <label style="color: #fff; font-size: 16px; margin-bottom: 10px; display: block;">审核日志</label>
            <div id="logBox" style="width: 100%; height: 200px; padding: 15px; border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; background: rgba(255, 255, 255, 0.05); color: #fff; font-family: monospace; white-space: pre-wrap; overflow-y: auto; text-align: left; font-size: 14px;"></div>
        </div>
        
        <button id="backButton" class="btn-login" onclick="window.location.href='panel.html'" style="display: none; margin-top: 20px;">返回控制台</button>
    </div>

    <script src="./eel.js"></script>
    <script src="./scripts/auth_check.js"></script>
    <script>
        // 等待EEL初始化完成
        eel._init();

        // 暴露给Python的函数 - 更新日志
        eel.expose(log_push);
        function log_push(message) {
            console.log("[INFO] 收到Log_push信号")
            console.log("[INFO] 日志内容:", message)
            const logBox = document.getElementById('logBox');
            const timestamp = new Date().toLocaleTimeString();
            logBox.innerHTML += `[${timestamp}] ${message}\n`;
            logBox.scrollTop = logBox.scrollHeight; // 滚动到底部
        }

        // 暴露给Python的函数 - 更新状态
        eel.expose(status_update);
        function status_update(status_code) {
            console.log("[INFO] 收到Status_update信号")
            const statusDisplay = document.getElementById('statusDisplay');
            const backButton = document.getElementById('backButton');

            // 根据状态码设置新状态
            if (status_code === 1) {
                statusDisplay.textContent = '审核成功!';
                statusDisplay.style.color = '#5cb85c';
                log_push('审核已成功完成');
            } else if (status_code === 2) {
                statusDisplay.textContent = '审核未通过';
                statusDisplay.style.color = '#d9534f';
                log_push('审核未通过，请修改内容后重试');
            } else if (status_code === 3) {
                statusDisplay.textContent = '审核进行中...';
                statusDisplay.style.color = '#2575fc';
            }

            // 显示返回按钮（状态1或2时）
            if (status_code === 1 || status_code === 2) {
                backButton.style.display = 'block';
            }
        }

        // 确保EEL完全初始化后再设置初始状态
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                status_update(3);
                log_push('开始审核流程...');
                
                // 页面加载完成后，自动开始AI审核
                eel.start_ai_review()(function(response) {
                    if (response && response.status === 'error') {
                        log_push('错误: ' + response.message);
                    }
                });
            }, 500);
        });
    </script>
</body>
</html>